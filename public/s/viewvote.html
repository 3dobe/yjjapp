<style>
    ul, ol {
        list-style-type: none;
    }
    #chart {
        margin: auto;
        display: block;
    }
    #words {
        padding-top: 6px;
        padding-bottom: 6px;
    }
    #words > li {
        padding: 4px;
    }
    .square {
        width: 24px;
        height: 24px;
        margin-right: 14px;
        display: inline-block;
    }
    .word {
        vertical-align: top;
    }
</style>

<div id="main-wrapper">
    <h1>投票详情</h1>
    <ul class="list-group">
        <li class="list-group-item">
            <span class="li-label">题目</span>
            <span id="content"></span>
        </li>
        <li class="list-group-item">
            <span class="li-label">选项相关</span>
            <ul id="words"></ul>
        </li>
        <li class="list-group-item">
            <span class="li-label">图表结果</span>
            <canvas id="chart" width="350" height="350"></canvas>
        </li>
    </ul>
</div>

<script>
    var vid = getHashParams()['vid'],
        colors = ["#F38630", "#E0E4CC", "#69D2E7", "#5E344C"];

    $.get('/do/s/viewvote?vid=' + vid, function(resObj) {
        var ok = resObj['ok'],
                msg = resObj['msg'];
        msg && alert(msg);
        if (! ok) return window.history.back();

        var vote = resObj['vote'],
                content = vote['content'],
                options = vote['options'];

        $('#content').text(content);
        var pairs = _.pairs(options),
            wordsHtml = _.reduce(pairs, function(memo, pair, i){
                return memo + [
                    '<li>',
                        '<div class="square"></div>',
                        '<span class="word">'+ pair[0] +'</span>',
                    '</li>'
                ].join('');
            }, '');
        $('#words').html(wordsHtml);
        $('.square').each(function(i, el) {
            $(el).css('background-color', colors[i]);
        });

        $('#chart').drawPieChart(options, colors);
    });

</script>