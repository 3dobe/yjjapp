
<div id="main-wrapper">
    <h1>抽奖详情</h1>
    <ul id="list-viewlottery" class="list-group">
        <li class="list-group-item">
            <span class="li-label">奖项简述</span>
            <span id="content"></span>
        </li>
        <li class="list-group-item">
            <span class="li-label">奖项相关</span>
            <ul id="words"></ul>
        </li>
        <li class="list-group-item">
            <span class="li-label">抽奖结果</span>
            <canvas id="rsult" width="350" height="350"></canvas>
        </li>
    </ul>
</div>

<script>
    var lyid = getHashParams()['lyid'],
            colors = ["#F38630", "#E0E4CC", "#69D2E7", "#5E344C"];

    $.get('/do/s/viewlottery?lyid=' + lyid, function(resObj) {
        var ok = resObj['ok'],
                msg = resObj['msg'];
        msg && alert(msg);
        if (! ok) return window.history.back();

        var lottery = resObj['lottery'],
                content = lottery['content'],
                options = lottery['options'];

        $('#content').text(content);
        var pairs = _.pairs(options),
                wordsHtml = _.reduce(pairs, function(memo, pair, i){
                    return memo + [
                        '<li>',
                        '<div class="square"></div>',
                        '<span class="word">'+ pair[0] +'</span>',
                        '</li>'
                    ].join('');
                }, '');
        $('#words').html(wordsHtml);
        $('.square').each(function(i, el) {
            $(el).css('background-color', colors[i]);
        });

        $('#rsult').drawPieLotteryResult(options, colors);
    });

</script>