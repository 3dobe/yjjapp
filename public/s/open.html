
<!-- css -->
<style>
	#vcode-canvas {
		width: 120px;
		height: 36px;
	}
    #form-open * {
        font-size: 20px;
    }
    #form-open .form-group {
        margin-bottom: 5px;
    }
    #form-open .form-control {
        padding: 12px;
        height: auto;
    }
    #form-open input-group-addon {
        padding: 3px 6px;
    }
    #form-open button {
        padding: 12px;
        height: auto;
    }
</style>

<div id="main-wrapper">
	<h1>申请讲座</h1>

	<form id="form-open">
		<div class="form-group">
			<input type="text" class="form-control" name="lname" placeholder="讲座名称">
		</div>
        <div class="form-group">
            <input type="text" class="form-control" name="lpwd" placeholder="管理密码">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="nick" placeholder="讲者昵称">
        </div>
		<div class="form-group">
			<div class="input-group">
				<input type="text" class="form-control" name="vcode" placeholder="验证码">
                <span class="input-group-addon">
					<canvas id="vcode-canvas" width="70" height="18"></canvas>
				</span>
			</div>
		</div>
		<button type="submit" class="btn btn-primary btn-lg btn-block">
			开启讲座
		</button>
	</form>

</div>



<!-- js -->
<script>
	showValicode();

	var $formOpen = $('#form-open');
	$formOpen.ajaxForm({
		type: 'post',
		url: '/do/s/open',
		success: function(resObj) {
			if (resObj['ok']) {
				loadFrame('#/view');
			} else {
				alert(resObj['msg']);
				showValicode();
                $formOpen.find('[name="vcode"]').val('');
			}
		}
	});

	function showValicode() {
		$.ajax({
			type: 'get',
			url: '/do/vcode',
			data: {
				'action': 'open'
			},
			success: function(resObj) {
				$.ajax({
					type: 'get',
					url: '/do/vcode',
					data: {
						'action': 'open'
					},
					success: function(resObj) {
						if (! resObj['ok']) {
							alert('获取验证码失败');
							return;
						}
						var vcodeInfo = resObj['vcodeInfo'],
							num1 = vcodeInfo['num1'],
							num2 = vcodeInfo['num2'],
							oper = vcodeInfo['oper'];
						$('#vcode-canvas').drawVerificationCode(num1, num2, oper);
					}
				});
			}
		});
	}
</script>
